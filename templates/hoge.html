<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>HTMLファイルからPOSTでJSONデータを送信する</title>
<script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.0/jquery.min.js"></script>
</head>
<body>
    <form action="upload.php" method="post" enctype="multipart/form-data">
        <p>
            <input type="file" name="upfile" id="upfile" accept="image/*" capture="camera" />
            <span style="color: #ff0000;" data-mce-style="color: #ff0000;"><div><img id="thumbnail" src=""></div></span>
        </p>
        <!--<p><input type="submit" name="post" value="post" /></p>-->
    </form>
          <script>
                $('#upfile').change(function(){
                  if (this.files.length > 0) {
                    // 選択されたファイル情報を取得
                    var file = this.files[0];
                    
                    // readerのresultプロパティに、データURLとしてエンコードされたファイルデータを格納
                    var reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = function() {
                        var img_base64 = reader.result;
                        $('#thumbnail').attr('src', img_base64 );
                        var JSONdata = {
                            "requests": [{
                                "image": img_base64,
                                "features": [ {} ]
                            }]
                        };

                        alert(JSON.stringify(JSONdata));

                        $.ajax({
                            type : 'post',
                            url : '/img_api',
                            data : JSON.stringify(JSONdata),
                            contentType: 'application/JSON',
                            dataType : 'JSON',
                            scriptCharset: 'utf-8',
                            success : function(data) {

                                // Success
                                alert("success");
                                alert(JSON.stringify(data));
                                $("#response").html("/img_api");
                            },
                            error : function(data) {

                                // Error
                                alert("error");
                                alert(JSON.stringify(data));
                                $("#response").html(JSON.stringify(data));
                            }
                        });
                    }
                  }
                });
            </script>
</body>
</html>